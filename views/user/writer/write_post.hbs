
{{#section 'title'}}
    <title>Write Post</title>
{{/section}}

{{#section 'css'}}
<script src="https://cdn.tiny.cloud/1/kfdqtmxvbc3j9y04vha77cyl4gs5br7u6q906lof2auidfz3/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
<script>
      tinymce.init({
        selector: '#txtContent',
        plugins: 'paste image link autolink lists table media a11ychecker advcode casechange formatpainter linkchecker checklist mediaembed permanentpen advtable tinymcespellchecker',
        menubar: false,
        toolbar: 'undo redo | bold italic underline strikethrough | numlist bullist | alignleft aligncenter alignright | forecolor backcolor | table link image media |casechange checklist code',
        toolbar_mode: 'floating',
      });
</script>\
{{/section}}

{{#section 'js'}}
<script>
  $('#frmWritePost').on('submit', function(e) {
    e.preventDefault();
    if (isEmptyText('txtTitle',"Title"))
      return;
    if (isEmptyText('txtAbstract',"Abstract"))
      return;
    if (isEmptyText('txtContent',"Content"))
      return;
    var array = [];
    var checkboxes = document.querySelectorAll('input[type=checkbox]:checked');
    if (checkboxes.length===0){
      alert( `You must take at least one tag for your post!`);
      return;
    }
    title = $('#txtTitle').val();
    $.getJSON(`/writer/is_duplicate_post?title=${title}`, function(data){
      if (data === false){
        alert('You wrote a post having the same title. Please write another one!');
        $('#txtTitle').focus();
        return;
      }
      $('#frmWritePost').off('submit').submit();
    })
  });

  function isEmptyText(idtext, message){
    const text = $(`#${idtext}`).val();
    if (text.length === 0){
      alert( `${message} is empty`);
      $(`#${idtext}`).focus();
      return true;
      }
    return false;
  }
</script>
{{/section}}

<h4 class="">Write New Posts</h4>
<form id="frmWritePost" method="post">
            <div class="form-group">
              <label for="txtTitle">Title</label>
              <input type="text" name="title" id="txtTitle" class="form-control" placeholder="Write post's Title here" size="1.5em" value="{{this.title}}">
            </div>
            <div class="form-group">
              <label for="txtAbstract">Abstract</label>
              <textarea type="text" name="abstract" id="txtAbstract" class="form-control" placeholder="Write post's Abstract here">{{this.abstract}}</textarea>
            </div>
            <div class="form-group">
              <label for="txtContent">Content</label>
              <textarea rows="15" type="text" name="content" id="txtContent" class="form-control" placeholder="Write post's Content here">{{this.content}}</textarea>
            </div>
            <div class="form-group">
              <label for="selectedCat">Select Category</label>
              <select class="form-control" id="selectedCat" name="category">
                {{#each this.list_cat}}
                  <option value="{{ID}}" {{#if selected}}selected="selected"{{/if}}>{{Name}}</option>
                {{/each}}
              </select>
            </div>
            <div class="form-group">
              <label for="selectedTag">Select Tags</label>
              <div class="container">
                <div class="row">
                  {{#each this.list_tag}}
                    <div class="form-check col-3">
                      <input class="form-check-input" type="checkbox" value="{{ID}}" id="cbTag{{ID}}" name="tag" {{#if selected}}checked="checked"{{/if}}>
                      <label class="form-check-label" for="cbTag{{ID}}">
                        {{Name}}
                      </label>
                    </div>
                  {{/each}}
                </div>
              </div>
            </div>
            <button type="submit" class="btn btn-success">
                <i class="fa fa-check" aria-hidden="true"></i>
                Save
            </button>
        </form>