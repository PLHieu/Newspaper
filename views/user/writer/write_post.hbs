{{#section 'title'}}
<title>
  {{#if postID}}
  Edit Post
  {{else}}
  Write Post
  {{/if}}
</title>
{{/section}}

{{#section 'css'}}
<link rel="stylesheet" href="/public/template/css/ticker-style.css">
<link rel="stylesheet" href="/public/template/css/flaticon.css">
<link rel="stylesheet" href="/public/template/css/slicknav.css">
<link rel="stylesheet" href="/public/template/css/animate.min.css">
<link rel="stylesheet" href="/public/template/css/magnific-popup.css">
<link rel="stylesheet" href="/public/template/css/fontawesome-all.min.css">
<link rel="stylesheet" href="/public/template/css/themify-icons.css">
<link rel="stylesheet" href="/public/template/css/slick.css">
<link rel="stylesheet" href="/public/template/css/nice-select.css">
<link rel="stylesheet" href="/public/template/css/style.css">
{{!--
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css"
  crossorigin="anonymous"> --}}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.min.css"
  crossorigin="anonymous">
<link href="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.2.2/css/fileinput.min.css" media="all"
  rel="stylesheet" type="text/css" />
<script src="https://cdn.tiny.cloud/1/kfdqtmxvbc3j9y04vha77cyl4gs5br7u6q906lof2auidfz3/tinymce/5/tinymce.min.js"
  referrerpolicy="origin"></script>
<script>
  tinymce.init({
    selector: '#txtContent',
    plugins: 'paste image link autolink lists table media a11ychecker advcode casechange formatpainter linkchecker checklist mediaembed permanentpen advtable tinymcespellchecker',
    menubar: false,
    toolbar: 'undo redo | bold italic underline strikethrough | numlist bullist | alignleft aligncenter alignright | forecolor backcolor | table link image media |casechange checklist code',
    toolbar_mode: 'floating',
    image_title: true,
    automatic_uploads: true,
    file_picker_types: 'image',
    file_picker_callback: function (cb, value, meta) {
      var input = document.createElement('input');
      input.setAttribute('type', 'file');
      input.setAttribute('accept', 'image/*');
      input.onchange = function () {
        var file = this.files[0];

        var reader = new FileReader();
        reader.onload = function () {
          var id = 'blobid' + (new Date()).getTime();
          var blobCache = tinymce.activeEditor.editorUpload.blobCache;
          var base64 = reader.result.split(',')[1];
          var blobInfo = blobCache.create(id, file, base64);
          blobCache.add(blobInfo);

          /* call the callback and populate the Title field with the file name */
          cb(blobInfo.blobUri(), { title: file.name });
        };
        reader.readAsDataURL(file);
      };

      input.click();
    },
    content_style: 'body { font-family:Helvetica,Arial,sans-serif; font-size:14px }'
  });
</script>
{{/section}}

{{#section 'js'}}
<!-- Jquery Mobile Menu -->
<script src="/public/template/js/jquery.slicknav.min.js"></script>

<!-- Jquery Slick , Owl-Carousel Plugins -->
<script src="/public/template/js/slick.min.js"></script>

<!-- One Page, Animated-HeadLin -->
<script src="/public/template/js/wow.min.js"></script>
<script src="/public/template/js/jquery.magnific-popup.js"></script>

<!-- Scrollup, nice-select, sticky -->
<script src="/public/template/js/jquery.scrollUp.min.js"></script>
<script src="/public/template/js/jquery.sticky.js"></script>

<!-- contact js -->
<script src="/public/template/js/jquery.ajaxchimp.min.js"></script>

<!-- Jquery Plugins, main Jquery -->
<script src="/public/template/js/main.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
  crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.2.2/js/fileinput.min.js"></script>

<script>
  $('#fCover').fileinput({
    allowedFileExtensions: ['jpg', 'gif', 'png'],
    dropZoneEnabled: false,
    'showUpload': false
  });

  $('#frmWritePost').on('submit', function (e) {
    e.preventDefault();
    if (isEmptyText('txtTitle', "Title"))
      return;
    if (isEmptyText('txtAbstract', "Abstract"))
      return;
    temp = tinymce.get('txtContent').getContent();
    if (temp.length === 0) {
      alert(`Content is empty`);
      $(`#txtContent`).focus();
      return;
    }
    if ($('#fCover').get(0).files.length === 0) {
      alert(`A post need a cover`);
      $('#fCover').focus();
      return;
    }
    var array = [];
    var checkboxes = document.querySelectorAll('input[type=checkbox]:checked');
    if (checkboxes.length === 0) {
      alert(`You must take at least one tag for your post!`);
      return;
    }
    title = $('#txtTitle').val();
    postID = $('#postID').val();
    $.getJSON(`/writer/is_duplicate_post?title=${title}&postID=${postID}`, function (data) {
      if (data === false) {
        alert('You wrote a post having the same title. Please write another one!');
        $('#txtTitle').focus();
        return;
      }
      $('#frmWritePost').off('submit').submit();
    })
  });

  function isEmptyText(idtext, message) {
    const text = $(`#${idtext}`).val();
    if (text.length === 0) {
      alert(`${message} is empty`);
      $(`#${idtext}`).focus();
      return true;
    }
    return false;
  }
</script>
{{/section}}
<style>
  body {
    color: #ff6b6b;
    background: #f5f5f5;
  }

  .wrap-column {
    background-color: white;
    border-radius: 10px;
    padding: 30px;
  }

  .form-group label {
    font-weight: bold;
    font-size: x-large;
  }

  .showtag {
    justify-content: space-between;
    flex-wrap: wrap;
  }

  .showtag label {
    font-size: medium;
    font-weight: lighter;
    color: black;
  }

  .input-group {
    height: 40px;
  }

  input.file-caption-name.form-control.kv-fileinput-caption {
    height: 100%;
  }

  .file-caption.icon-visible span.file-caption-icon {
    font-size: x-large;
    font-weight: bold;
    height: 100%;
    top: 0;
    left: 0;
    padding: 4px;
  }

  .file-footer-caption {
    margin-bottom: 0px !important;
  }

  .file-upload-indicator {
    visibility: hidden;
  }

  .btn.btn-primary.btn-file {
    background: #ee4a41;
    border: none;
    padding: 10px;
    height: 100%;
    display: flex;
    justify-content: space-around;
    align-items: center;
    border-top-right-radius: 10px;
    border-bottom-right-radius: 10px;
  }

  .btn.btn-primary.btn-file:hover {
    background-color: #be5853;
  }

  .btn.btn-primary.btn-file:active {
    background-color: #be5853;
  }

  .file-preview-thumbnails {
    display: flex;
  }

  .krajee-default.file-preview-frame {
    margin: auto;
    display: block;
  }

  button.kv-file-zoom.btn.btn-sm.btn-kv.btn-default.btn-outline-secondary {
    padding: 6px;
    border-radius: 6px;
    font-size: large;
    font-weight: bold;
  }

  .input-group-btn.input-group-append {
    height: 100%;
  }

  button.btn.btn-default.btn-secondary.fileinput-remove.fileinput-remove-button {
    padding: 10px;
    margin-left: 10px;
    margin-right: 3px;
    border-top-left-radius: 10px;
    border-bottom-left-radius: 10px;
  }

  button.luubaiviet {
    padding: 30px;
    border-radius: 10px;
    font-weight: bold;
    font-size: medium;
    height: 30px;
  }

  .kv-zoom-actions button {
    padding: 6px;
    border-radius: 6px;
    font-size: large;
    font-weight: bold;
  }
</style>

{{> header-top}}

<div class="container">
  <br>
  <div class="row">
    <div class="col-md-12">
      <h2 style="font-weight: bold; color:#ff6b6b">Viết bài mới</h2>
    </div>
  </div>
  <br>
  <form class="row" id="frmWritePost" method="post" enctype="multipart/form-data">
    <div class="col-md-8 wrap-column mr-4">
      <div class="form-group ">
        <label for="txtTitle">Tiêu đề</label>
        <input type="text" name="title" id="txtTitle" class="form-control inputtext-wrap-inside"
          placeholder="Write post's Title here" size="3em" value="{{this.title}}">
      </div>

      <div class="form-group mt-5">
        <label for="txtAbstract">Tóm tắt</label>
        <textarea type="text" name="abstract" id="txtAbstract" class="form-control inputtext-wrap-inside"
          placeholder="Write post's Abstract here">{{this.abstract}}</textarea>
      </div>

      <div class="form-group mt-5">
        <label for="txtContent">Nội dung</label>
        <textarea rows="15" type="text" name="content" id="txtContent" class="form-control "
          placeholder="Write post's Content here">{{this.content}}</textarea>
      </div>

      <div class="form-group" style="margin-top: 2rem !important">
        <label for="fCover">Cover</label>
        <input type="file" name="cover" id="fCover" class="form-control d-block" />
      </div>
    </div>

    <div class="col-md-3 ">
      <div class="form-group wrap-column " style="height: 180px;">
        <label for="selectedCat">Danh mục</label>
        <select class="form-control" id="selectedCat" name="category">
          {{#each this.list_cat}}
          <option value="{{ID}}" {{#if selected}}selected="selected" {{/if}}>{{Name}}</option>
          {{/each}}
        </select>
      </div>

      <div class="form-group wrap-column" style="margin-top: 2rem !important">
        <label for="selectedTag">Tags</label>
        <div class="div d-flex  showtag">
          {{#each this.list_tag}}

          <div class="form-check ">
            <input class="form-check-input" type="checkbox" value="{{ID}}" id="cbTag{{ID}}" name="tag" {{#if
              selected}}checked="checked" {{/if}} />
            <label class="form-check-label" for="cbTag{{ID}}">
              {{Name}}
            </label>
          </div>
          {{/each }}
        </div>
      </div>

      <div class="form-group" style="margin-top: 2rem !important">
        <button type="submit" class="btn custom-btn w-100 luubaiviet">
          Save
        </button>
      </div>
    </div>
  </form>
  <br>
</div>